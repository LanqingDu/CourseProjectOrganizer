<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phased Gantt Chart Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .gantt-grid {
            display: grid;
            grid-template-columns: repeat(var(--num-days), minmax(30px, 1fr));
            font-size: 0.875rem;
            position: relative;
            border: 1px solid #e5e7eb;
            border-bottom: 0;
            border-right: 0;
            overflow: hidden;
        }
        .gantt-label {
            padding: 8px;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            text-align: center;
        }
        .gantt-task-bar {
            height: 20px;
            border-radius: 4px;
            color: white;
            font-size: 0.75rem;
            padding: 0 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin: 5px;
            transform-origin: center;
        }
        .today-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #ef4444; /* red-500 */
            z-index: 5;
            pointer-events: none;
        }
    </style>
</head>
<body class="p-6 md:p-10">

    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-2">
            Phased Gantt Chart Generator
        </h1>
        <p class="text-center text-gray-500 mb-8">
            Define your project's phases and tasks to create a visual timeline.
        </p>

        <!-- Main container for all phases -->
        <div id="phases-container" class="space-y-6 mb-8">
            <!-- Phase input blocks will be added here dynamically -->
        </div>

        <div class="flex flex-col md:flex-row gap-4 mb-8">
            <button id="add-phase-btn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Add Phase
            </button>
            <button id="generate-chart-btn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Generate Chart
            </button>
        </div>

        <!-- Gantt Chart Visualization Area -->
        <div id="chart-container" class="relative overflow-x-auto bg-gray-50 rounded-xl shadow-inner p-4 md:p-6 min-h-[400px]">
            <!-- Chart content will be dynamically generated here -->
            <p class="text-center text-gray-400 p-8">Your Gantt chart will appear here after you click "Generate Chart".</p>
        </div>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addPhaseBtn = document.getElementById('add-phase-btn');
            const generateChartBtn = document.getElementById('generate-chart-btn');
            const phasesContainer = document.getElementById('phases-container');
            const chartContainer = document.getElementById('chart-container');
            
            // The main data structure to hold all project information
            let projectPhases = [
                {
                    id: 'phase-0',
                    name: 'Project Kickoff',
                    tasks: [
                        { name: 'Initial Research', startDate: '2025-10-01', endDate: '2025-10-05' },
                        { name: 'Stakeholder Meeting', startDate: '2025-10-06', endDate: '2025-10-07' }
                    ]
                },
                {
                    id: 'phase-1',
                    name: 'Development',
                    tasks: [
                        { name: 'Frontend Design', startDate: '2025-10-08', endDate: '2025-10-15' },
                        { name: 'Backend Implementation', startDate: '2025-10-16', endDate: '2025-10-25' }
                    ]
                }
            ];

            // Helper function to get a random Tailwind background color class
            function getRandomColor() {
                const colors = ['bg-blue-500', 'bg-green-500', 'bg-red-500', 'bg-purple-500', 'bg-pink-500', 'bg-orange-500', 'bg-indigo-500', 'bg-teal-500'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            // Function to render all phases and tasks in the input area
            function renderInputs() {
                phasesContainer.innerHTML = '';
                projectPhases.forEach((phase, phaseIndex) => {
                    const phaseDiv = document.createElement('div');
                    phaseDiv.className = 'phase-block bg-white rounded-lg shadow-md border border-gray-200 p-4';
                    phaseDiv.innerHTML = `
                        <div class="flex items-center justify-between mb-4">
                            <input type="text" value="${phase.name}" data-phase-id="${phase.id}" data-field="name" class="phase-name-input text-xl font-bold p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 w-full md:w-auto">
                            <button class="remove-phase-btn bg-red-400 text-white font-bold p-2 rounded-lg hover:bg-red-500 transition duration-300 ease-in-out transform hover:scale-105 ml-4" data-phase-id="${phase.id}">Remove Phase</button>
                        </div>
                        <div class="tasks-container space-y-3" data-phase-id="${phase.id}">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center p-2 bg-gray-50 rounded-lg">
                                <div class="text-gray-600 font-semibold">Task Name</div>
                                <div class="text-gray-600 font-semibold">Start Date</div>
                                <div class="text-gray-600 font-semibold">End Date</div>
                                <div class="text-gray-600 font-semibold"></div>
                            </div>
                        </div>
                        <button class="add-task-btn bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition duration-300 ease-in-out mt-4 transform hover:scale-105" data-phase-id="${phase.id}">Add Task</button>
                    `;
                    const tasksContainer = phaseDiv.querySelector('.tasks-container');
                    phase.tasks.forEach((task, taskIndex) => {
                        const taskRow = document.createElement('div');
                        taskRow.className = 'grid grid-cols-1 md:grid-cols-4 gap-4 items-center p-2 bg-white rounded-lg border border-gray-200 shadow-sm';
                        taskRow.innerHTML = `
                            <input type="text" value="${task.name}" data-phase-id="${phase.id}" data-task-index="${taskIndex}" data-field="name" class="task-input p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <input type="date" value="${task.startDate}" data-phase-id="${phase.id}" data-task-index="${taskIndex}" data-field="startDate" class="task-input p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <input type="date" value="${task.endDate}" data-phase-id="${phase.id}" data-task-index="${taskIndex}" data-field="endDate" class="task-input p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <button class="remove-task-btn bg-red-400 text-white font-bold p-2 rounded-lg hover:bg-red-500 transition duration-300 ease-in-out transform hover:scale-105" data-phase-id="${phase.id}" data-task-index="${taskIndex}">Remove</button>
                        `;
                        tasksContainer.appendChild(taskRow);
                    });
                    phasesContainer.appendChild(phaseDiv);
                });
            }

            // Function to find the phase by its ID
            function findPhase(id) {
                return projectPhases.find(p => p.id === id);
            }

            // Handles updates to phase and task inputs
            function handleInputChange(e) {
                const input = e.target;
                const phaseId = input.dataset.phaseId;
                const field = input.dataset.field;
                const phase = findPhase(phaseId);

                if (input.classList.contains('phase-name-input')) {
                    phase.name = input.value;
                } else if (input.classList.contains('task-input')) {
                    const taskIndex = parseInt(input.dataset.taskIndex);
                    if (phase && phase.tasks[taskIndex]) {
                        phase.tasks[taskIndex][field] = input.value;
                    }
                }
            }

            // Handles adding a new phase
            function addPhase() {
                const newId = `phase-${projectPhases.length}`;
                projectPhases.push({
                    id: newId,
                    name: `New Phase ${projectPhases.length + 1}`,
                    tasks: []
                });
                renderInputs();
            }

            // Handles removing a phase
            function removePhase(e) {
                const phaseId = e.target.dataset.phaseId;
                projectPhases = projectPhases.filter(p => p.id !== phaseId);
                renderInputs();
            }

            // Handles adding a new task to a specific phase
            function addTask(e) {
                const phaseId = e.target.dataset.phaseId;
                const phase = findPhase(phaseId);
                if (phase) {
                    phase.tasks.push({ name: '', startDate: '', endDate: '' });
                }
                renderInputs();
            }

            // Handles removing a task
            function removeTask(e) {
                const phaseId = e.target.dataset.phaseId;
                const taskIndex = parseInt(e.target.dataset.taskIndex);
                const phase = findPhase(phaseId);
                if (phase && phase.tasks[taskIndex]) {
                    phase.tasks.splice(taskIndex, 1);
                }
                renderInputs();
            }

            // Function to adjust font sizes of task names to fit the bars
            function adjustFontSizes() {
                const taskBars = document.querySelectorAll('.gantt-task-bar');
                taskBars.forEach(bar => {
                    const textElement = bar.querySelector('.task-name-text');
                    if (textElement) {
                        // Reset transform to get accurate scrollWidth
                        textElement.style.transform = 'scale(1)';

                        const barWidth = bar.clientWidth;
                        const textWidth = textElement.scrollWidth;
                        
                        // If text overflows, scale it down
                        if (textWidth > barWidth) {
                            const scale = barWidth / textWidth;
                            textElement.style.transform = `scale(${scale})`;
                        }
                    }
                });
            }

            // Main function to generate the Gantt chart
            function generateChart() {
                const allTasks = projectPhases.flatMap(p => p.tasks).filter(t => t.startDate && t.endDate);
                
                if (allTasks.length === 0) {
                    chartContainer.innerHTML = '<p class="text-center text-gray-400 p-8">Please add tasks and dates to generate the chart.</p>';
                    return;
                }
                
                const allDates = allTasks.flatMap(t => [new Date(t.startDate), new Date(t.endDate)]);
                const minDate = new Date(Math.min(...allDates));
                const maxDate = new Date(Math.max(...allDates));
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const dateRange = (maxDate - minDate) / (1000 * 60 * 60 * 24);
                
                // Adjust for one-day tasks
                const numDays = dateRange > 0 ? Math.ceil(dateRange) + 1 : 1; 

                // Generate a list of all dates in the timeline
                const timelineDates = [];
                let currentDate = new Date(minDate);
                for (let i = 0; i < numDays; i++) {
                    timelineDates.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                // Prepare monthly headers
                const monthHeaders = {};
                timelineDates.forEach(date => {
                    const monthKey = date.toLocaleString('default', { month: 'long', year: 'numeric' });
                    if (!monthHeaders[monthKey]) {
                        monthHeaders[monthKey] = {
                            start: date,
                            count: 1
                        };
                    } else {
                        monthHeaders[monthKey].count++;
                    }
                });
                
                chartContainer.innerHTML = '';
                const ganttGrid = document.createElement('div');
                ganttGrid.className = 'gantt-grid';
                ganttGrid.style.setProperty('--num-days', numDays);

                // Month headers
                Object.keys(monthHeaders).forEach(month => {
                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'gantt-label font-bold text-center';
                    monthDiv.textContent = month;
                    monthDiv.style.gridColumn = `span ${monthHeaders[month].count}`;
                    ganttGrid.appendChild(monthDiv);
                });
                
                // Day headers
                timelineDates.forEach(date => {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'gantt-label text-xs';
                    dayDiv.textContent = date.getDate();
                    ganttGrid.appendChild(dayDiv);
                });

                projectPhases.forEach(phase => {
                    // Phase header
                    const phaseLabel = document.createElement('div');
                    phaseLabel.className = 'gantt-label font-bold phase-header';
                    phaseLabel.textContent = phase.name;
                    phaseLabel.style.gridColumn = `1 / span ${numDays}`;
                    ganttGrid.appendChild(phaseLabel);

                    // Tasks for this phase
                    phase.tasks.forEach(task => {
                        const taskStartDate = new Date(task.startDate);
                        const taskEndDate = new Date(task.endDate);
                        if (isNaN(taskStartDate) || isNaN(taskEndDate)) return;

                        const startDay = (taskStartDate - minDate) / (1000 * 60 * 60 * 24);
                        const duration = (taskEndDate - taskStartDate) / (1000 * 60 * 60 * 24);

                        const startCol = 1 + startDay;
                        const endCol = startCol + (duration > 0 ? duration + 1 : 1);
                        const colorClass = getRandomColor();

                        const taskBar = document.createElement('div');
                        taskBar.className = `gantt-task-bar ${colorClass}`;
                        taskBar.style.gridColumn = `${startCol} / ${endCol}`;
                        
                        const textSpan = document.createElement('span');
                        textSpan.className = 'task-name-text';
                        textSpan.textContent = task.name;
                        taskBar.appendChild(textSpan);
                        
                        ganttGrid.appendChild(taskBar);
                    });
                });

                chartContainer.appendChild(ganttGrid);
                
                const todayDiff = (today - minDate) / (1000 * 60 * 60 * 24);
                if (todayDiff >= 0 && todayDiff <= numDays) {
                    const todayLine = document.createElement('div');
                    todayLine.className = 'today-line';
                    const colWidth = ganttGrid.querySelector('.gantt-label').offsetWidth;
                    todayLine.style.left = `${todayDiff * colWidth}px`;
                    ganttGrid.appendChild(todayLine);
                }

                // Call the function to adjust font sizes after rendering
                adjustFontSizes();
            }

            // Event listeners
            addPhaseBtn.addEventListener('click', addPhase);
            generateChartBtn.addEventListener('click', generateChart);
            phasesContainer.addEventListener('change', handleInputChange);
            phasesContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-task-btn')) {
                    addTask(e);
                } else if (e.target.classList.contains('remove-phase-btn')) {
                    removePhase(e);
                } else if (e.target.classList.contains('remove-task-btn')) {
                    removeTask(e);
                }
            });

            // Adjust font sizes on window resize
            window.addEventListener('resize', adjustFontSizes);

            // Initial render
            renderInputs();
            generateChart();
        });
    </script>
</body>
</html>
